@prefix sh:      <http://www.w3.org/ns/shacl#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix skos:    <http://www.w3.org/2004/02/skos/core#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema:  <https://schema.org/> .
@prefix bibo:    <http://purl.org/ontology/bibo/> .
@prefix prov:    <http://www.w3.org/ns/prov#> .
@prefix locn:    <http://www.w3.org/ns/locn#> .
@prefix wgs84:   <http://www.w3.org/2003/01/geo/wgs84_pos#> .

# Tu espacio para la clase Documento (ajústalo si cambió):
@prefix ccdoc: <https://comisioncorograficadigital.github.io/ccd-ontology/ontology/documento/> .
# Esquemas SKOS (starter que publicaste):
@prefix cctop: <https://comisioncorograficadigital.github.io/ccd-ontology/ontology/topico/> .

#################################################################
# SHAPES DE APOYO (reutilizables)
#################################################################

# Valor debe ser IRI y skos:Concept
ccdoc:ConceptValue a sh:NodeShape ;
  sh:property [
    sh:path rdf:type ;
    sh:hasValue skos:Concept
  ] ;
  sh:nodeKind sh:IRI .

# Concepto de Tipología (en el esquema cctop:Tipologia)
ccdoc:TipologiaConcept a sh:NodeShape ;
  sh:nodeKind sh:IRI ;
  sh:property [
    sh:path rdf:type ; sh:hasValue skos:Concept
  ] ;
  sh:property [
    sh:path skos:inScheme ; sh:hasValue cctop:Tipologia
  ] .

# Concepto de Tema (en el esquema cctop:Tema) — por ahora vacío (estructura)
ccdoc:TemaConcept a sh:NodeShape ;
  sh:nodeKind sh:IRI ;
  sh:property [ sh:path rdf:type ; sh:hasValue skos:Concept ] ;
  sh:property [ sh:path skos:inScheme ; sh:hasValue cctop:Tema ] .

# Concepto de Técnica (cctop:Tecnica)
ccdoc:TecnicaConcept a sh:NodeShape ;
  sh:nodeKind sh:IRI ;
  sh:property [ sh:path rdf:type ; sh:hasValue skos:Concept ] ;
  sh:property [ sh:path skos:inScheme ; sh:hasValue cctop:Tecnica ] .

# Concepto de Material (cctop:Material)
ccdoc:MaterialConcept a sh:NodeShape ;
  sh:nodeKind sh:IRI ;
  sh:property [ sh:path rdf:type ; sh:hasValue skos:Concept ] ;
  sh:property [ sh:path skos:inScheme ; sh:hasValue cctop:Material ] .

# Concepto de Cobertura temporal (cctop:CoberturaTemporal) — comité definirá términos
ccdoc:CoberturaTemporalConcept a sh:NodeShape ;
  sh:nodeKind sh:IRI ;
  sh:property [ sh:path rdf:type ; sh:hasValue skos:Concept ] ;
  sh:property [ sh:path skos:inScheme ; sh:hasValue cctop:CoberturaTemporal ] .

#################################################################
# NÚCLEO: Documento (aplica a TODAS las tipologías)
#################################################################

ccdoc:DocumentoShape a sh:NodeShape ;
  sh:targetClass ccdoc:Documento ;

  # Título: literal, 1..1
  sh:property [
    sh:path dcterms:title ;
    sh:minCount 1 ; sh:maxCount 1 ;
    sh:datatype xsd:string
  ] ;

  # Identificador: al menos 1 (no forzamos patrón aquí)
  sh:property [
    sh:path dcterms:identifier ;
    sh:minCount 1
  ] ;

  # Tipo (Tipología): al menos 1, debe ser IRI a skos:Concept de cctop:Tipologia
  sh:property [
    sh:path dcterms:type ;
    sh:minCount 1 ;
    sh:node ccdoc:TipologiaConcept
  ] ;

  # Tema(s): opcional, pero si hay, deben ser IRIs a skos:Concept de cctop:Tema
  sh:property [
    sh:path dcterms:subject ;
    sh:node ccdoc:TemaConcept
  ] ;

  # Técnica(s): opcional, IRIs a skos:Concept de cctop:Tecnica
  sh:property [
    sh:path schema:artform ;
    sh:node ccdoc:TecnicaConcept
  ] ;

  # Material(es): opcional, IRIs a skos:Concept de cctop:Material
  sh:property [
    sh:path schema:material ;
    sh:node ccdoc:MaterialConcept
  ] ;

  # Cobertura temporal: opcional, IRIs a skos:Concept de cctop:CoberturaTemporal
  sh:property [
    sh:path dcterms:temporal ;
    sh:node ccdoc:CoberturaTemporalConcept
  ] ;

  # Fechas comunes (no todas aplican siempre; control suave)
  sh:property [ sh:path dcterms:issued  ; sh:or ( [ sh:datatype xsd:date ] [ sh:datatype xsd:dateTime ] ) ] ;
  sh:property [ sh:path dcterms:created ; sh:or ( [ sh:datatype xsd:date ] [ sh:datatype xsd:dateTime ] ) ] ;
  sh:property [ sh:path dcterms:date    ; sh:or ( [ sh:datatype xsd:date ] [ sh:datatype xsd:dateTime ] ) ] ;

  # Relaciones genéricas (si están, que sean IRIs)
  sh:property [ sh:path dcterms:isPartOf     ; sh:nodeKind sh:IRI ] ;
  sh:property [ sh:path dcterms:hasPart      ; sh:nodeKind sh:IRI ] ;
  sh:property [ sh:path dcterms:isVersionOf  ; sh:nodeKind sh:IRI ] ;
  sh:property [ sh:path dcterms:hasVersion   ; sh:nodeKind sh:IRI ] ;
  sh:property [ sh:path prov:wasDerivedFrom  ; sh:nodeKind sh:IRI ] ;
  sh:property [ sh:path prov:wasRevisionOf   ; sh:nodeKind sh:IRI ] ;

  # Localización/espacial: si hay, que sea IRI (Place u otro recurso)
  sh:property [ sh:path dcterms:spatial ; sh:nodeKind sh:IRI ] ;
  sh:property [ sh:path schema:location ; sh:nodeKind sh:IRI ] .

#################################################################
# SUBCLASES (restricciones suaves y muy razonables)
#################################################################

# Sección de libro → debe estar dentro de un Libro
ccdoc:SeccionDeLibroShape a sh:NodeShape ;
  sh:targetClass bibo:Chapter ;
  sh:property [
    sh:path dcterms:isPartOf ;
    sh:minCount 1 ;
    sh:nodeKind sh:IRI
    # Si quieres ser estricto y sabes que el recurso padre está tipado como bibo:Book,
    # puedes añadir sh:class bibo:Book aquí. Lo dejamos suave para no romper ingestiones.
    # sh:class bibo:Book
  ] ;
  # Páginas (si las usas; opcionales, literales)
  sh:property [ sh:path bibo:pageStart ] ;
  sh:property [ sh:path bibo:pageEnd ] .

# Artículo de revista (si manejas clase específica, p. ej. ccd:JournalArticle)
ccdoc:ArticuloDeRevistaShape a sh:NodeShape ;
  sh:targetClass bibo:Article ;
  # Si se modela “en revista” vía isPartOf, al menos 1 relación
  sh:property [ sh:path dcterms:isPartOf ; sh:nodeKind sh:IRI ] ;
  # Fecha de publicación suele ser relevante
  sh:property [ sh:path dcterms:issued ; sh:or ( [ sh:datatype xsd:date ] [ sh:datatype xsd:dateTime ] ) ] ;
  # Volumen/número (opcionales)
  sh:property [ sh:path bibo:volume ] ;
  sh:property [ sh:path bibo:issue ] ;
  sh:property [ sh:path bibo:pageStart ] ;
  sh:property [ sh:path bibo:pageEnd ] .

# Carta → emisor y destinatario (si se usan)
ccdoc:CartaShape a sh:NodeShape ;
  sh:targetClass bibo:Letter ;
  sh:property [ sh:path schema:sender    ; sh:nodeKind sh:IRI ] ;
  sh:property [ sh:path schema:recipient ; sh:nodeKind sh:IRI ] .

# Mapa → al menos un espacial; opcional “modified” (criterio cartografía)
ccdoc:MapaShape a sh:NodeShape ;
  sh:targetClass bibo:Map ;
  sh:property [ sh:path dcterms:spatial ; sh:minCount 1 ; sh:nodeKind sh:IRI ] ;
  sh:property [ sh:path dcterms:modified ; sh:datatype xsd:date ] ;
  # Geometría y coordenadas (opcionales; libres por ahora)
  sh:property [ sh:path locn:geometry ] ;
  sh:property [ sh:path wgs84:lat ] ;
  sh:property [ sh:path wgs84:long ] .

# Imagen / Lámina → técnica/material (opcionales, pero si hay, que sean conceptos SKOS)
ccdoc:ImagenShape a sh:NodeShape ;
  sh:targetClass <http://purl.org/dc/dcmitype/Image> ;
  sh:property [ sh:path schema:artform  ; sh:node ccdoc:TecnicaConcept ] ;
  sh:property [ sh:path schema:material ; sh:node ccdoc:MaterialConcept ] .
